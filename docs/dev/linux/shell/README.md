# Shell 基础总结

Shell是所有解释器的总称  
Shell是用户与Linux内核之间的解释器  
解释器负责将用户的指令翻译为内核可以识别的指令

- 常见的Shell解释器

/bin/bash 默认  
/bin/sh  
/bin/csh  
/bin/tcsh  

::: details bash基本特性

快捷键、Tab键补齐（Ctrl+A：光标移至当前行最前面、Ctrl+E：光标移至当前行最前面、Ctrl+C：撤销准备执行命令、**Ctrl+L：清屏**）  

history：命令历史  

aliase：命令别名  

标准输入与输出的重定向（>、>>、2>、3>>、&>）  
`>`重定向输出`ls > a.text`（每次执行，会覆盖上次输出同名文件）  
`>>`重定向追加输出`ls > a.text`（每次执行，会基于上次输出同名文件内容追加输出内容）
`2>`重定向输出报错信息`ls 不存在文件.text 2> a.text`  
`&>`重定向输出正确及报错信息`ls 不存在文件.text b.text &> a.text`  

管道（|）：将多条命令组合，满足复杂功能  
将前一个命令的输出结果 通过管道 传递第二条命令作为它的输入信息  
`ls | grep -`根据列表数据过滤出包含 - 的文件名

:::

> 可以通过usermod、chsh修改所使用的解释器

Shell执行命令的方式

- 交互式（命令行）
  - 人工干预
  - 逐条解释执行、效率低
- 非交互式（脚本）
  - 需要提前设计
  - 批量执行、效率高

## 脚本设计与运行

脚本：提前将可执行的命令语句写入一个文件（顺序执行、解释器逐行解释代码）

常见的脚本语言（Shell脚本、Python/Perl/Ruby脚本、JSP/PHP脚本...）

- 一个合格规范脚本应该包含以下这些内容
  - #!脚本声明（使用哪种解释器解释代码）
  - 注释信息（步骤、思路、用途等），以#开头的为注释信息
  - 可执行语句
```bash
#!/bin/bash
#一个bash测试脚本
echo "你好世界"
```

- 执行脚本的多种方式
  - 方法一，需要为文件赋予可执行权限（通过chmod分配权限）
    - 绝对路径执行
    - 相对路径执行
  - 方法二，不需要文件有可执行的权限
    - sh [脚本文件名]
    - source [脚本文件名]  #不会启动子进程（通过pstree查看进程树）

## 变量

### 自定义变量

```bash
a=3
echo $a       #3
echo ${a}     #3
echo ${a}456  #3456
unset a
```

#### 定义变量

以固定的名称，存放可以能有变化的值

- 定义变量的格式
  - 变量名=变量值
- 取消变量的格式
  - unset 变量名

> =两边不能有空格，不要使用关键字做变量名，如ls、cd等  
> 如果变量名已经存在则覆盖之前的变量值  
> 变量名称由 字母/数字/下划线组成，不能以数字开始  

#### 查看变量

- 查看变量的语法格式
  - $变量名
  - ${变量名}

### 环境变量

变量名通常大写，由操作系统维护

- 存储在/etc/profile或~/.bash_profile（linux）
- 命令env可以列出所有环境变量
- 常见环境变量
  - PATH：命令搜索路径（查询命令所在路径）
  - PWD：工作目录路径
  - USER: 当前用户名
  - UID：当前用户ID号
  - HOME：当前用户的家目录
  - SHELL：当前shell解释器

### 位置变量

bash（解释器）内置变量，存储脚本执行时的参数

- 存储脚本执行时的参数
- 使用$n表示，n为数字序列号
- $1、$2、...、${10}、${11}、... （10之后需要用花括号包裹）

```bash
#定义vars.sh文件
echo $1
echo $2
echo $3

#执行vars.sh
sh vars.sh aa 99 cc
#打印 aa 99 cc
```

### 预定义变量

bash（解释器）内置变量，可以调用但是不能赋值或修改

- 用来保存脚本程序的执行信息
  - 直接使用这些变量
  - 不能直接为这些变量赋值

| 变量名 | 含义 |
| :-: | :-: |
|$?|*上一条*命令执行后的返回状态，0：正常，[不等于0]：表示异常|
|$0|当前所在的进程或脚本名|
|$$|当前运行进程的PID号|
|$#|已加载的位置变量的个数|
|$*|所有位置变量的值|

### 变量的扩展应用

#### 多种引号的区别

- 区分三种定界符
  - 双引号""：允许扩展，以$引用其它变量
  - 单引号''：禁用扩展，即便$也视为普通字符
  - 反引号``：将命令的执行输出作为变量值，$()与反引号等效

```bash
echo "$USER id is $UID"
#root id is 0

echo '$USER id is $UID'
#$USER id is $UID

a=`ls` #a=$(ls)
echo a
#CNAME data.json deploy.sh docs logo.png node_modules package.json package-lock.json test 我的博客.xmind
```

#### read标准输入取值

- read从键盘读入变量值完成赋值
  - 格式：`read -p "提示信息" 变量名`
  - -p 可选（提示文字），-t 指定超时秒数，-s 设置是否在终端显示输入内容

下方有示例

### 局部与全局

变量的作用范围

- 局部变量
  - 新定义的变量默认只在当前Shell环境中有效，无法在子Shell环境中使用
- 全局变量
  - 全局变量在当前Shell及子Shell环境中均有效

```bash
a=123 #定义局部变量
export b=456 #定义全局变量
```

## 运算

## 示例

### 第一个Shell脚本

1. 新建文件
2. 添加可执行语句（命令）
3. 给文件添加x（可执行权限）执行权限

first.sh
```
echo "你好世界"
```

### 位置变量示例

user.sh
```bash
#!/bin/bash
# 新增用户并修改密码 sh user.sh huang 123456

useradd "$1"

echo "$2" | passwd --stdin $1
```

### read标准输入取值

read.sh
```bash
#!/bin/bash
# 新增用户并修改密码

read -p "请输入用户名：" name
read -t 6 -s -p "请输入密码：" pass

useradd "$name" #加引号防止用户输入空格，如 "huang jin"
echo "$pass" | passwd --stdin $name
```
